{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Empleados SES</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      background: #f2f3f5;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      padding-top: 5rem;
      color: #1f2937;
    }

    .card {
      background: #ffffff;
      border-radius: 1rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
    }

    .alert-error {
      background-color: rgba(255, 0, 0, 0.15);
      color: #1e2835;
      border: 1px solid rgba(255, 0, 0, 0.3);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(10px);
    }

    .alert-success {
      background-color: rgba(0, 128, 0, 0.15);
      color: #1e2835;
      border: 1px solid rgba(0, 128, 0, 0.3);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(10px);
    }

    .btn {
      padding: .6rem 1rem;
      border-radius: .5rem;
      font-weight: 600;
      transition: .2s;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-primary:hover {
      background: #099268;
    }

    .btn-secondary {
      background: #6b7280;
      color: white;
    }

    .btn-secondary:hover {
      background: #c92a2a;
    }

    .btn-danger {
      background: #dc2626;
      color: white;
    }

    .btn-danger:hover {
      background: #b91c1c;
    }

    .btn-warning {
      background: #2563eb;
      color: white;
    }

    .btn-warning:hover {
      background: #1e40af;
    }
  </style>

  {% include "includes/navbar.html" %}
</head>

<body>
  <div class="max-w-6xl mx-auto px-4">

    <!-- FORMULARIO -->
    <div class="card p-8 mb-2">
      <h2 class="text-3xl font-bold mb-6 text-center">Registrar Empleado</h2>

      {% if messages %}
      {% for message in messages %}
      {% if "crear" in message.tags %}
      <div class="{{ message.tags }}">{{ message }}</div>
      {% endif %}
      {% endfor %}
      {% endif %}

      <form method="POST" class="space-y-4">
        {% csrf_token %}
        <input type="hidden" name="action" value="crear">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input name="nombre_completo" placeholder="Nombre completo" class="p-3 border border-gray-300 rounded-lg" />
          <input name="email" type="email" placeholder="Correo electrónico"
            class="p-3 border border-gray-300 rounded-lg" />
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input name="cedula" placeholder="Cédula" class="p-3 border border-gray-300 rounded-lg" />
          <input name="telefono" placeholder="Teléfono" class="p-3 border border-gray-300 rounded-lg" />
        </div>

        <input name="direccion" placeholder="Dirección" class="w-full p-3 border border-gray-300 rounded-lg" />

        <div>
          <label class="text-sm text-gray-700">Fecha de contratación</label>
          <input type="date" name="fecha_contratacion" class="mt-1 p-3 border border-gray-300 rounded-lg w-full" />
        </div>

        <button class="btn btn-primary bg-green-500 w-full">Registrar</button>
      </form>
    </div>


    <!-- TABLA -->
    <div class="card p-8">
      <h2 class="text-3xl font-bold mb-6 text-center">Lista de empleados</h2>

      {% if messages %}
      {% for message in messages %}
      {% if "editar" in message.tags %}
      <div class="{{ message.tags }}">{{ message }}</div>
      {% endif %}
      {% endfor %}
      {% endif %}

      <div class="overflow-x-auto">
        <table class="w-full border border-gray-300 rounded-lg text-sm">
          <thead class="bg-gray-500 text-white border-b border-gray-300">
            <tr class="uppercase">
              <th class="p-3">Nombre</th>
              <th class="p-3">Correo</th>
              <th class="p-3">Cédula</th>
              <th class="p-3">Teléfono</th>
              <th class="p-3 text-center">Estado</th>
              <th class="p-3 text-center">Acciones</th>
            </tr>
          </thead>

          <tbody>
            {% for empleado in empleados %}
            <tr class="border-b border-gray-200">
              <td class="p-3">{{ empleado.nombre_completo }}</td>
              <td class="p-3">{{ empleado.email }}</td>
              <td class="p-3">{{ empleado.cedula }}</td>
              <td class="p-3">{{ empleado.telefono|default:"—" }}</td>

              <td class="p-3 text-center">
                {% if empleado.estado %}
                <span class="bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-semibold">Activo</span>
                {% else %}
                <span class="bg-red-100 text-red-700 px-3 py-1 rounded text-xs font-semibold">Inactivo</span>
                {% endif %}
              </td>

              <td class="p-3">
                <div class="flex justify-center gap-2 flex-wrap">

                  <button onclick="abrirModalDesdeDataset(this)" data-id="{{ empleado.id_empleado }}"
                    data-nombre="{{ empleado.nombre_completo|escapejs }}" data-email="{{ empleado.email|escapejs }}"
                    data-cedula="{{ empleado.cedula|escapejs }}"
                    data-telefono="{{ empleado.telefono|default_if_none:''|escapejs }}"
                    data-direccion="{{ empleado.direccion|default_if_none:''|escapejs }}"
                    data-fecha="{{ empleado.fecha_contratacion|date:'Y-m-d' }}"
                    class="btn bg-yellow-500 text-white">Editar</button>

                  <form method="POST" action="{% url 'empleados' %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="cambiar_estado">
                    <input type="hidden" name="empleado_id" value="{{ empleado.id_empleado }}">

                    <button class="btn btn-secondary text-xs 
           {% if empleado.estado %} bg-red-500 {% else %} bg-green-500 {% endif %}">
                      {% if empleado.estado %} Inactivar {% else %} Activar {% endif %}
                    </button>
                  </form>

                  <a href="{% url 'auditoria_empleado' empleado.id_empleado %}"
                    class="btn btn-warning bg-blue-500 text-xs">Auditoría</a>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="p-4 text-center text-gray-500">No hay empleados registrados</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- PAGINACIÓN -->
    <div class="flex justify-center mt-6 mb-6">
      <nav class="flex items-center space-x-1">

        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}"
          class="px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600">
          « Anterior
        </a>
        {% else %}
        <span class="px-3 py-1 bg-gray-300 text-gray-500 rounded cursor-not-allowed">« Anterior</span>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
        {% if num == page_obj.number %}
        <span class="px-3 py-1 bg-gray-200 text-gray-900 border border-gray-400 rounded">{{ num }}</span>
        {% elif num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %} <a href="?page={{ num }}"
          class="px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600">{{ num }}</a>
          {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}"
            class="px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600">
            Siguiente »
          </a>
          {% else %}
          <span class="px-3 py-1 bg-gray-300 text-gray-500 rounded cursor-not-allowed">Siguiente »</span>
          {% endif %}

      </nav>
    </div>


    <!-- MODAL EDITAR -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center p-4">
      <div class="card p-6 w-full max-w-lg">
        <h3 class="text-2xl font-bold mb-4 text-center">Editar empleado</h3>

        <form id="form-editar" method="POST" class="space-y-3">
          {% csrf_token %}
          <input type="hidden" name="action" value="editar">
          <input type="hidden" name="empleado_id" id="id_empleado">

          <input id="edit_nombre" name="nombre_completo" class="w-full p-3 border border-gray-300 rounded-lg" />
          <input id="edit_email" name="email" type="email" class="w-full p-3 border border-gray-300 rounded-lg" />
          <input id="edit_cedula" name="cedula" class="w-full p-3 border border-gray-300 rounded-lg" />
          <input id="edit_telefono" name="telefono" class="w-full p-3 border border-gray-300 rounded-lg" />
          <input id="edit_direccion" name="direccion" class="w-full p-3 border border-gray-300 rounded-lg" />
          <input id="edit_fecha" name="fecha_contratacion" type="date"
            class="w-full p-3 border border-gray-300 rounded-lg" />

          <div class="flex justify-end gap-3 pt-3">
            <button type="button" onclick="cerrarModal()" class="btn btn-secondary">Cancelar</button>
            <button class="btn btn-primary">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    function abrirModalDesdeDataset(btn) {
      document.getElementById('modal').classList.remove('hidden');
      document.getElementById('modal').classList.add('flex');

      document.getElementById('id_empleado').value = btn.dataset.id;
      document.getElementById('edit_nombre').value = btn.dataset.nombre;
      document.getElementById('edit_email').value = btn.dataset.email;
      document.getElementById('edit_cedula').value = btn.dataset.cedula;
      document.getElementById('edit_telefono').value = btn.dataset.telefono;
      document.getElementById('edit_direccion').value = btn.dataset.direccion;
      document.getElementById('edit_fecha').value = btn.dataset.fecha;
    }

    function cerrarModal() {
      const modal = document.getElementById('modal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  </script>

</body>

</html>